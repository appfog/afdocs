<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>AppFog &mdash; Documentation MongoDB</title> 

		<link rel="stylesheet" href="http://appfog.com/css/style.css">
		<link href="/css/prettify.css" type="text/css" rel="stylesheet" />
		<link href="/css/table.css" rel="stylesheet">
		<link href="/css/docs.css" rel="stylesheet">
		<!-- typekit -->
		<script type="text/javascript" src="http://use.typekit.com/abw3xjt.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
				
		<!-- css -->

		<!-- modernizr -->
		<script src="http://appfog.com/js/libs/modernizr-2.5.3.min.js"></script>

		<script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
		<script type="text/javascript" src="/js/jquery.js"></script>
		<script type="text/javascript" src="/js/bootstrap.js"></script>

		<!--  -->
		<link rel="icon" type="image/png" href="http://appfog.com/favicon.ico" />
		
		<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-16856502-8']);
      _gaq.push(['_setDomainName', '.appfog.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
		
	</head>
	<body id="blog" onload="prettyPrint()">
	<div id="header">
		<div class="container">
			<a href="http://appfog.com/" id="app_fog"><img src="http://appfog.com/img/app-fog.png" width="189" height="47" alt="App Fog"></a>
			<ul id="main_nav">
				<li id="nproducts">
					<a href="#" title="Products" class="parent"><span>Products</span></a>
					<ul>
						<li><a href="http://appfog.com/products/appfog">AppFog</a></li>
						<li><a href="http://appfog.com/products/phpfog">PHP Fog</a></li>
					</ul>
				</li>
				<li id="npricing">
					<a href="#" title="Pricing" class="parent"><span>Pricing</span></a>
					<ul>
						<li><a href="https://console.appfog.com/pricing">AppFog</a></li>
						<li><a href="http://appfog.com/products/phpfog/pricing/">PhpFog</a></li>
					</ul>
				</li>
				<li id="nshowcase"><a href="http://appfog.com/showcase/" title="Showcase">Showcase</a></li>
				<li id="nabout"><a href="http://appfog.com/about/" title="About">About</a></li>
				<li id="nsupport"><a href="http://appfog.com/support/" title="Support">Support</a></li>
				<li id="nblog"><a href="http://blog.appfog.com/" title="Blog">Blog</a></li>

				<li id="nlogin">
						  <a href="#" title="Log In" class="btn gray">Log In <i class="icon-chevron-down"></i></a>
						  <form id="log_in_form" class="dropdown">
							<div class="container">
							  <!-- <div class="half">
								<div class="radio_btn" id="log_in_product_php_fog">
								  <span>
									<input type="radio" name="products" value="" id="log_in_php_fog" checked>
								  </span>
								  <label for="log_in_php_fog">Php Fog</label>
								</div>
							  </div>
							  <div class="half">
								<div class="radio_btn" id="log_in_product_appfog">
								  <span>
									<input type="radio" name="products" value="" id="log_in_appfog">
								  </span>
								  <label for="log_in_appfog">AppFog</label>
								</div>
								
							  </div>
							</div> -->
										
							<!-- <hr> -->

							<!-- <div class="container appfog">
							  <input type="email" name="email" value="" id="appfog_log_in_email" placeholder="Email" class="text">
							  <input type="password" name="password" value="" id="appfog_log_in_password" placeholder="Password" class="text">
							</div>
							
							<div class="container php_fog">
							  <input type="email" name="email" value="" id="php_fog_log_in_email" placeholder="Email" class="text">
							  <input type="password" name="password" value="" id="php_fog_log_in_password" placeholder="Password" class="text">
							</div> -->
										

										
							<!-- <div class="container">  
							  <div class="half">
								<div class="checkbox">
								  <span class="active">
									<input type="checkbox" name="remember_me" value="" id="log_in_remember_me" checked>
								  </span>
								</div>
								<label for="log_in_remember_me" class="remember_me">Remember Me</label>
							  </div>

							  <div class="half forgot_password">
								<a href="#">Forgot Password?</a>
							  </div>
							</div> -->
										<a href="https://phpfog.com/login" class="btn bright_green submit" style="font-size: 13px;">Log In to PHP Fog</a>
										<hr>
										<a href="https://console.appfog.com/login" class="btn bright_green submit" style="font-size: 13px;">Log In to AppFog</a>
									</form>
								</li>
								<li id="nsignup">
									<a href="#" title="Sign Up" class="btn bright_green">Sign Up <i class="icon-chevron-down"></i></a>
									<form id="sign_up_form" class="dropdown">
							<!-- <div class="container">
							  <div class="half">
								<div class="radio_btn" id="sign_up_product_php_fog">
								  <span>
									<input type="radio" name="products" value="" id="sign_up_php_fog" checked>
								  </span>
								  <label for="sign_up_php_fog">Php Fog</label>
								</div>
							  </div>
							  <div class="half">
								<div class="radio_btn" id="sign_up_product_appfog">
								  <span>
									<input type="radio" name="products" value="" id="sign_up_appfog">
								  </span>
								  <label for="sign_up_appfog">AppFog</label>
								</div>
								
							  </div>
							</div> -->
										
										<!-- <hr>
													
													<div class="container php_fog">
													  <input type="email" name="email" value="" id="sign_up_php_fog_email" placeholder="Email" class="text">
													  <input type="password" name="password" value="" id="sign_up_password" placeholder="Password" class="text">
													  <input type="password" name="password_confirmation" value="" id="sign_up_password_confirmation" placeholder="Password Confirmation" class="text">
													</div>
													
													<div class="container appfog">
													  <input type="email" name="email" value="" id="sign_up_appfog_email" placeholder="Email" class="text">
													</div> -->
										
										<a href="https://phpfog.com/signup" class="btn bright_green submit" style="font-size: 13px;">Register for PHP Fog</a>
										<hr>
										<a href="http://appfog.com/signup.php" class="btn bright_green submit" style="font-size: 13px;">Register for AppFog</a>
									</form>
								</li>

			</ul>
		</div> 
	</div>
	<div id="main_content">
		<div class='container'>

			
			<div id="top_bar" class="row gray_blue margin_bottom">
				<div class="span12">
					<a href="/"><h1 class="title">AppFog Docs</h1></a>
					<ul id="docs_nav">
						
						<li class="breadcrumb-separator">&raquo;</li>
						<li><a href="/services">Services</a></li>
						
						<li class="breadcrumb-separator">&raquo;</li>
						<li><a href="#">MongoDB</a></li>
					</ul>
					<ul id="secondary_nav">
						<li><a href="http://docs.phpfog.com">PHP Fog Docs</a></li>
					</ul>
				</div>

			</div>
			
					


			<div id="content" class="row white">
				<div class="span8 main_content">
					<div class="row entries">
	<div class="span8">
		<div class="row">
			<div class="span8">
				<h1>MongoDB</h1>
				<p>AppFog provides a MongoDB service that’s accessible to apps that are running on any of the supported runtimes and frameworks. </p>

<ul>
  <li><a href="#ruby">Ruby</a></li>
  <li><a href="#node">Node.js</a></li>
  <li><a href="#walkthrough">Node.js with MongoDB Walkthrough</a></li>
  <li><a href="#php">PHP</a></li>
</ul>

<h1 id="ruby">Ruby</h1>

<p>You can use the <a href="http://mongomapper.com/">MongoMapper ORM</a> to adapt your Ruby app to access the AppFog MongoDB service.</p>

<h3 id="gemfile">Gemfile</h3>

<p>First, add the MongoMapper gem, as well as BSON for serialization of JSON-like documents, which is necessary for interfacing with the MongoDB Ruby driver:</p>

<pre class="prettyprint linenums"><code>gem 'mongo_mapper'
gem 'bson_ext'
</code></pre>

<p>And install the gems:</p>

<pre class="prettyprint"><code>$ gem install "mongo_mapper"
</code></pre>

<pre class="prettyprint"><code>$ gem install "bson_ext"
</code></pre>

<h3 id="rails">Rails</h3>

<p>For a Rails app, modify the production section of your app’s <code>config/mongo.yml</code> to set credentials, host, and port by parsing the JSON-formatted <code>VCAP_SERVICES</code> environment variable:</p>

<pre class="prettyprint linenums"><code>production:
host: &lt;%= JSON.parse(ENV['VCAP_SERVICES'])['mongodb-1.8'].first['credentials']['hostname'] rescue 'localhost' %&gt;
port: &lt;%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['port'] rescue 27017 %&gt;
database:  &lt;%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['db'] rescue 'tutorial_db' %&gt;
username: &lt;%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['username'] rescue '' %&gt;
password: &lt;%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['password'] rescue '' %&gt;
</code></pre>

<p>For other Ruby apps, use the <code>JSON.parse()</code> code to extract the information you need to construct a <a href="http://www.mongodb.org/display/DOCS/Connections">MongoDB connection string</a> from the <code>VCAP_SERVICES</code> environment variable.</p>

<h3 id="bundle">Bundle</h3>

<pre class="prettyprint"><code>$ bundle package
$ bundle install
</code></pre>

<h3 id="deploy">Deploy</h3>

<p>When <code>af</code> asks if you want to bind any services, enter <code>y</code> and choose <code>mongodb</code> from the menu. Provide a name for the service or accept the default:</p>

<pre class="prettyprint"><code>$ af push --runtime ruby193
    Would you like to deploy from the current directory? [Yn]:
    Application Name: test
    Application Deployed URL [test.aws.af.cm]:
    Detected a Sinatra Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [256M]:
    Creating Application: OK
    Would you like to bind any services to 'test'? [yN]: y
    Would you like to use an existing provisioned service [yN]? N
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    Please select one you wish to provision: 1
    Specify the name of the service [mongodb-example1]:
    Creating Service: OK
    Binding Service [mongodb-example1]: OK
    Uploading Application:
        Checking for available resources: OK
        Processing resources: OK
        Packing application: OK
    Uploading (8K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</code></pre>

<h1 id="node">Node.js</h1>

<p>Before you begin, make sure you have <a href="http://nodejs.org/">Node.js</a> and <a href="http://www.mongodb.org/">MongoDB</a> installed on your development computer.</p>

<p>Check out our <a href="/frameworks/node">doc on deploying Node.js apps</a>.</p>

<h3 id="setup">Setup</h3>

<p>Start <code>mongod</code> in your local environment:</p>

<pre class="prettyprint"><code>$ mongod
</code></pre>

<h3 id="push">Push</h3>

<p>Push your Node.js app to AppFog and bind a new MongoDB service to it:</p>

<pre class="prettyprint"><code>$ af push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: mongo-node-example
    Application Deployed URL [mongo-node-example.aws.af.cm]:
    Detected a Node.js Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
    Creating Application: OK
    Would you like to bind any services to 'mongo-node-example'? [yN]: y
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    Please select one you wish to provision: 1
    Specify the name of the service [mongodb-example1]:
    Creating Service: OK
    Binding Service [mongodb-example1]: OK
    Uploading Application:
        Checking for available resources: OK
        Packing application: OK
        Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</code></pre>

<h3 id="configure-mongodb">Configure MongoDB</h3>

<p>Next, update your app to use the MongoDB connection information and credentials, both locally and on AppFog, by adding the following code to the beginning of <code>app.js</code>:</p>

<pre class="prettyprint linenums"><code>if(process.env.VCAP_SERVICES){
    var env = JSON.parse(process.env.VCAP_SERVICES);
    var mongo = env['mongodb-1.8'][0]['credentials'];
}
else{
    var mongo = {
    "hostname":"localhost",
    "port":27017,
    "username":"",
    "password":"",
    "name":"",
    "db":"db"
    }
}

var generate_mongo_url = function(obj){
    obj.hostname = (obj.hostname || 'localhost');
    obj.port = (obj.port || 27017);
    obj.db = (obj.db || 'test');

    if(obj.username &amp;&amp; obj.password){
        return "mongodb://" + obj.username + ":" + obj.password + "@" + obj.hostname + ":" + obj.port + "/" + obj.db;
    }
    else{
        return "mongodb://" + obj.hostname + ":" + obj.port + "/" + obj.db;
    }
}

var mongourl = generate_mongo_url(mongo);
</code></pre>

<p>The if statement provides two different sets of information, depending on whether the app is running locally or on AppFog. <code>generate_mongo_url</code> creates appropriate connection information for MongoDB, which is then assigned to <code>mongourl</code>.</p>

<p>Your app is now configured for MongoDB.</p>

<p>Need a more detailed walkthrough? Keep reading.</p>

<h1 id="walkthrough">Node.js with MongoDB Walkthrough</h1>

<p>Before you start, make sure:</p>

<ul>
  <li>You have <a href="https://console.appfog.com/signup">an AppFog account</a>.</li>
  <li>The <a href="/getting-started/af-cli"><code>af</code> command line tool</a> is installed on your development computer. </li>
  <li><a href="http://nodejs.org/">Node.js</a> is installed on your development computer.</li>
  <li><a href="http://www.mongodb.org/">MongoDB</a> is installed on your development computer.</li>
</ul>

<h3 id="setup-1">Setup</h3>

<p>Start <code>mongod</code> in your local environment with the following command:</p>

<pre class="prettyprint"><code>$ mongod
</code></pre>

<p>Confirm that Node.js is installed correctly by starting the interactive javascript console:</p>

<pre class="prettyprint"><code>$ node
</code></pre>

<p>Hit <code>Control-C</code> to exit.</p>

<p>Confirm that Node Package Manager (NPM) is installed:</p>

<pre class="prettyprint"><code>$ npm -v
1.0.6
</code></pre>

<p>Log in to AppFog:</p>

<pre class="prettyprint"><code>$ af login
</code></pre>

<h3 id="write-a-basic-nodejs-app">Write a Basic Node.js App</h3>

<p>We’ll write a basic Node.js app called <code>mongo-node-example</code>.</p>

<p>First, create a directory and change into it:</p>

<pre class="prettyprint"><code>$ mkdir mongo-node-example
$ cd mongo-node-example
</code></pre>

<p>Create a file <code>app.js</code> with the following code:</p>

<pre class="prettyprint linenums"><code>var port = (process.env.VMC_APP_PORT || 3000);
var host = (process.env.VCAP_APP_HOST || 'localhost');
var http = require('http');

http.createServer(function (req, res) {
    res.writeHead(200, {'Content-Type': 'text/plain'});
    res.end('Hello World\n');
}).listen(port, host);
</code></pre>

<p>This creates a Node.js web server using <code>port 3000</code> on <code>localhost</code> that responds to any <code>HTTP</code> request with the string “Hello World”.</p>

<p>Start the Node.js web server locally:</p>

<pre class="prettyprint"><code>$ node app.js
</code></pre>

<p>In another terminal window send a request:</p>

<pre class="prettyprint"><code>$ curl localhost:3000
Hello World
</code></pre>

<p>Alternatively, browse to <code>http://localhost:3000</code> to see the response from the web server.</p>

<p>Hit <code>Control-C</code> in the first terminal window to stop the web server.</p>

<h3 id="deploy-1">Deploy</h3>

<p>Next, push the application to AppFog. Hit <code>Enter</code> to accept the defaults, but enter a unique name for the app and set up a <code>mongodb</code> service:</p>

<pre class="prettyprint"><code>$ af push
Would you like to deploy from the current directory? [Yn]:
Application Name: mongo-node-example
Application Deployed URL [mongo-node-example.aws.af.cm]:
Detected a Node.js Application, is this correct? [Yn]:
Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
Creating Application: OK
Would you like to bind any services to 'mongo-node-example'? [yN]: y
The following system services are available
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
Please select one you wish to provision: 1
Specify the name of the service [mongodb-example1]:
Creating Service: OK
Binding Service [mongodb-example1]: OK
Uploading Application:
    Checking for available resources: OK
    Packing application: OK
    Uploading (0K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</code></pre>

<h3 id="test">Test</h3>

<pre class="prettyprint"><code>$ curl mongo-node-example.aws.af.cm
Hello World
</code></pre>

<h3 id="add-mongodb-configuration">Add MongoDB Configuration</h3>

<p>Your app is now deployed and has a new <code>mongodb</code> service bound to it, but it’s not using the service yet. Next, we’ll configure the app to use the MongoDB connection information and credentials, both locally and on AppFog.</p>

<p>Add the following code to the beginning of <code>app.js</code>:</p>

<pre class="prettyprint linenums"><code>if(process.env.VCAP_SERVICES){
    var env = JSON.parse(process.env.VCAP_SERVICES);
    var mongo = env['mongodb-1.8'][0]['credentials'];
}
else{
    var mongo = {
        "hostname":"localhost",
        "port":27017,
        "username":"",
        "password":"",
        "name":"",
        "db":"db"
    }
}

var generate_mongo_url = function(obj){
    obj.hostname = (obj.hostname || 'localhost');
    obj.port = (obj.port || 27017);
    obj.db = (obj.db || 'test');

    if(obj.username &amp;&amp; obj.password){
        return "mongodb://" + obj.username + ":" + obj.password + "@" + obj.hostname + ":" + obj.port + "/" + obj.db;
    }
    else{
        return "mongodb://" + obj.hostname + ":" + obj.port + "/" + obj.db;
    }
}

var mongourl = generate_mongo_url(mongo);
</code></pre>

<p>The if statement provides two different sets of information, depending on whether the app is running locally or on AppFog. <code>generate_mongo_url</code> creates appropriate connection information for MongoDB, which is then assigned to <code>mongourl</code>.</p>

<h3 id="test-your-app-locally">Test your app locally</h3>

<pre class="prettyprint"><code>$ node app.js
</code></pre>

<p>In another terminal:</p>

<pre class="prettyprint"><code>$ curl localhost:3000
</code></pre>

<p>The app should return the string “Hello World”.</p>

<h3 id="deploy-your-update">Deploy your update</h3>

<pre class="prettyprint"><code>$ af update mongo-node-example
Uploading Application:
    Checking for available resources: OK
    Packing application: OK
    Uploading (1K): OK
Push Status: OK
Stopping Application: OK
Staging Application: OK
Starting Application: OK
</code></pre>

<h3 id="test-your-app-on-appfog">Test your app on AppFog</h3>

<pre class="prettyprint"><code>$ curl mongo-node-example.aws.af.cm
Hello World
</code></pre>

<h3 id="add-mongodb-functionality">Add MongoDB Functionality</h3>

<p>Next, install the MongoDB native drivers locally and update the app to use MongoDB.</p>

<p>Install MongoDB native drivers locally:</p>

<pre class="prettyprint"><code>$ npm install mongodb
</code></pre>

<p>This creates a new local directory called <code>node_modules</code> in the app’s root.</p>

<p>In <code>app.js</code>, create a new function called <code>record_visit</code> that stores the server request to MongoDB:</p>

<pre class="prettyprint linenums"><code>var record_visit = function(req, res){
    /* Connect to the DB and auth */
    require('mongodb').connect(mongourl, function(err, conn){
        conn.collection('ips', function(err, coll){
            /* Simple object to insert: ip address and date */
            object_to_insert = { 'ip': req.connection.remoteAddress, 'ts': new Date() };

            /* Insert the object then print in response */
            /* Note the _id has been created */
            coll.insert( object_to_insert, {safe:true}, function(err){
            res.writeHead(200, {'Content-Type': 'text/plain'});
            res.write(JSON.stringify(object_to_insert));
            res.end('\n');
            });
        });
    });
}
</code></pre>

<p>The <code>.connect</code> method connects to MongoDB using either the local or AppFog <code>mongourl</code>. Then the <code>.collection('ips', ...)</code> method adds the request information to the data that will be committed.</p>

<p>Update the <code>http.createServer</code> method so that it calls the <code>record_visit</code> function when the server request is made:</p>

<pre class="prettyprint"><code>http.createServer(function (req, res) {
    record_visit(req, res);
}).listen(port, host);
</code></pre>

<h3 id="test-your-app-locally-1">Test your app locally</h3>

<pre class="prettyprint"><code>$ node app.js
</code></pre>

<p>and from another terminal:</p>

<pre class="prettyprint"><code>$ curl localhost:3000
{"ip":"127.0.0.1","ts":"2011-12-29T23:22:38.192Z","_id":"4efcf63ecab9a5b41e000001"}
</code></pre>

<p>Hit <code>Control-C</code> in the first terminal to stop the web server.</p>

<h3 id="test-your-app-on-appfog-1">Test your app on AppFog</h3>

<pre class="prettyprint"><code>$ af update mongo-node-example
$ curl mongo-node-example.aws.af.cm
{"ip":"127.0.0.1","ts":"2011-12-29T23:24:25.199Z","_id":"4efcf6a927996b5f79000001"}
</code></pre>

<p>Create a function <code>print_visits</code> that prints the last ten visits/requests:</p>

<pre class="prettyprint"><code>var print_visits = function(req, res){
    /* Connect to the DB and auth */
    require('mongodb').connect(mongourl, function(err, conn){
        conn.collection('ips', function(err, coll){
            coll.find({}, {limit:10, sort:[['_id','desc']]}, function(err, cursor){
                cursor.toArray(function(err, items){
                    res.writeHead(200, {'Content-Type': 'text/plain'});
                    for(i=0; i&lt;items.length;i++){
                        res.write(JSON.stringify(items[i]) + "\n");
                    }
                    res.end();
                });
            });
        });
    });
}
</code></pre>

<p>Update the <code>createServer</code> method to call the new <code>print_visits</code> function:</p>

<pre class="prettyprint"><code>http.createServer(function (req, res) {
    params = require('url').parse(req.url);
    if(params.pathname === '/history') {
        print_visits(req, res);
    }
    else{
        record_visit(req, res);
    }
}).listen(port, host);
</code></pre>

<p>Web server requests will either add the current visit to MongoDB (the default) or, if url includes “/history”, output the last ten visits.</p>

<h3 id="test-your-app-locally-2">Test your app locally</h3>

<pre class="prettyprint"><code>$ curl localhost:3000
{"ip":"127.0.0.1","ts":"2011-12-29T23:44:30.254Z","_id":"4efcfb5e2f9d30481f000003"}
$ curl localhost:3000/history
{"ip":"127.0.0.1","ts":"2011-12-29T23:44:30.254Z","_id":"4efcfb5e2f9d30481f000003"}
{"ip":"127.0.0.1","ts":"2011-12-29T23:31:39.339Z","_id":"4efcf85b2f9d30481f000002"}
{"ip":"127.0.0.1","ts":"2011-12-29T23:31:26.678Z","_id":"4efcf84e2f9d30481f000001"}
{"ip":"127.0.0.1","ts":"2011-12-29T23:22:38.192Z","_id":"4efcf63ecab9a5b41e000001"}
</code></pre>

<p>Stop the application locally and update it on AppFog.</p>

<pre class="prettyprint"><code>$ af update mongo-node-example
Uploading Application:
    Checking for available resources: OK
    Processing resources: OK
    Packing application: OK
Uploading (8K): OK
Push Status: OK
Stopping Application: OK
Staging Application: OK
Starting Application: OK
</code></pre>

<h3 id="test-your-app-on-appfog-2">Test your app on AppFog</h3>

<pre class="prettyprint"><code>$ curl mongo-node-example.aws.af.cm/history
{"ip":"127.0.0.1","ts":"2011-12-29T23:49:46.738Z","_id":"4efcfc9acbfffadc0b000001"}
{"ip":"127.0.0.1","ts":"2011-12-29T23:24:25.199Z","_id":"4efcf6a927996b5f79000001"}
</code></pre>

<h1 id="php">PHP</h1>

<p>Connecting your PHP app to a bound MongoDB service is simple:</p>

<pre class="prettyprint linenums"><code>$services_json = json_decode(getenv("VCAP_SERVICES"),true);
$mongo_config = $services_json["mongodb-1.8"][0]["credentials"];

$username = $mongo_config["username"];
$password = $mongo_config["password"];
$hostname = $mongo_config["hostname"];
$port = $mongo_config["port"];
$db = $mongo_config["db"];
$name = $mongo_config["name"]; 

$connect = "mongodb://${username}:${password}@${hostname}:${port}/${db}";
$m = new Mongo($connect);
$db = $m-&gt;selectDB($db); 
</code></pre>

<h1 id="links">Links</h1>

<p>For another complete sample app for a Node.js app with MongoDB, check out <a href="https://github.com/appfog/af-node-sample-mongodb">our GitHub repo</a>.</p>

<p>For more information, check out <a href="http://docs.cloudfoundry.com/services/mongodb/nodejs-mongodb.html">Cloud Foundry’s documentation on MongoDB</a>.</p>


			</div>
		</div>
	</div>
</div>

				</div>

				<div class="span3 sidebar padding accordion" id="accordion2">
					<!--
					<div class="row border-bottom">
						<div class="span3">
							<form id="search-form" action="/search">
								<input type="search" placeholder="Search" id="search" name="q" size="30" />
								<input class="btn gray_blue search" type="submit" value="Go" />
							</form>
						</div>
					</div>-->
					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseZero"><h6><i class="accordion-icon icon-chevron-right"></i> Getting Started</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseZero" style="height: 0;">
						
							<div class="accordion-inner">
								
								<li><a href="/getting-started/jumpstarts" >Jumpstarts</a></li>
								
								<li><a href="/getting-started/af-cli" >AF Command Line Tool</a></li>
								
							</div>
						</ul>
					</div>
					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
						<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo"><h6><i class="accordion-icon icon-chevron-right"></i> Frameworks</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseTwo" style="height: 0;">
						
							<div class="accordion-inner">
							
							<li><a href="/frameworks/java" >Java</a></li>
							
							<li><a href="/frameworks/node" >Node</a></li>
							
							<li><a href="/frameworks/php" >PHP</a></li>
							
							<li><a href="/frameworks/python" >Python</a></li>
							
							<li><a href="/frameworks/ruby" >Ruby</a></li>
							
							</div>
						</ul>
					</div>

					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree"><h6><i class="accordion-icon icon-chevron-down"></i> Services</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse in" id="collapseThree" style="height: auto;">
						
							<div class="accordion-inner">
							
							<li><a href="/services/overview" >Overview</a></li>
							
							<li><a href="/services/tunneling" >Tunneling</a></li>
							
							<li><a href="/services/mysql" >MySQL</a></li>
							
							<li><a href="/services/mongodb" class="on">MongoDB</a></li>
							
							<li><a href="/services/postgresql" >PostgreSQL</a></li>
							
							</div>
						</ul>
					</div>

					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne"><h6><i class="accordion-icon icon-chevron-right"></i> Customize</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseOne" style="height: 0;">
						
							<div class="accordion-inner">
								
								<li><a href="/customize/custom-domain-names" >Custom Domain Names</a></li>
								
								<li><a href="/customize/ssl" >SSL for Custom Domains</a></li>
								
								<li><a href="/customize/task-scheduling" >Task-scheduling</a></li>
								
							</div>
						</ul>
					</div>
					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseFour"><h6><i class="accordion-icon icon-chevron-right"></i> Add-ons</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseFour" style="height: 0;">
						
							<div class="accordion-inner">
							
							<li><a href="/add-ons/searchify" >Searchify</a></li>
							
							<li><a href="/add-ons/mongolab" >MongoLab</a></li>
							
							<li><a href="/add-ons/mongohq" >MongoHQ</a></li>
							
							<li><a href="/add-ons/mailgun" >Mailgun</a></li>
							
							<li><a href="/add-ons/blitz" >Blitz</a></li>
							
							<li><a href="/add-ons/ironworker" >IronWorker</a></li>
							
							<li><a href="/add-ons/ironmq" >IronMQ</a></li>
							
							<li><a href="/add-ons/cloudmailin" >CloudMailin</a></li>
							
							<li><a href="/add-ons/cleardb" >ClearDB</a></li>
							
							<li><a href="/add-ons/memcachier" >MemCachier</a></li>
							
							<li><a href="/add-ons/statsmix" >StatsMix</a></li>
							
							<li><a href="/add-ons/nexmo" >Nexmo</a></li>
							
							<li><a href="/add-ons/cloudinary" >Cloudinary</a></li>
							
							<li><a href="/add-ons/partners" >Add-on Partnership</a></li>
							
							</div>
						</ul>
					</div>

						<div class="row border-bottom"><div class="span3"><a href="/faq" ><h6>FAQ</h6></div></a></div>
						<div class="row border-bottom"><div class="span3"><a href="http://console.appfog.com/pricing"><h6>Pricing</h6></a></div></div>
						<div class="row border-bottom"><div class="span3"><a href="/billing" ><h6>BILLING</h6></div></a></div>
						<div class="row border-bottom"><div class="span3"><a href="/troubleshooting" ><h6>Troubleshooting</h6></div></a></div>
						<!--<div class="row border-bottom"><div class="span3"><a href="/architecture" ><h6>Architecture</h6></div></a></div>-->
						<div class="row border-bottom"><div class="span3"><a href="/roadmap" ><h6>Feature Roadmap</h6></div></a></div>

					</div>
				</div>
			</div><!-- content -->
		</div><!-- container -->
	</div><!-- main_content -->

	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="span1">
					<img src="http://appfog.com/img/bydevfordev_95.png" width="95" height="79" alt="By Developers For Developers" id="badge">
				</div>
				<div class="span3">
					<h4>About AppFog</h4>
					<p>Easily build and deploy fast, scalable, and reliable applications to the cloud in seconds. Yeah, it’s that easy.</p>					
				</div>
				<div class="span2">
					<h4>Info</h4>
					<ul>
						<li><a href="http://appfog.com/support/">Support</a></li>
						<li><a href="https://appfog.com/about/">About</a></li>
						<li><a href="http://dev.appfog.com/">Documentation</a></li>
					</ul>
				</div>
				<div class="span2 offsettop">
					<ul>
						<li>Phone: 1.888.974.7364</li>
						<li>&copy; <script>document.write(new Date().getFullYear());</script> AppFog.</li>
						<li>All Rights Reserved.</li>
					</ul>
				</div>
				<div class="span4">
					<h4>Social</h4>
					<ul id="social">
						<li id="facebook"><a href="http://www.facebook.com/pages/AppFog/159333004147490">Facebook</a></li>
						<li id="twitter"><a href="https://twitter.com/#!/appfog">Twitter</a></li>
						<li id="linkedin"><a href="http://www.linkedin.com/company/appfog">LinkedIn</a></li>
					</ul>
				</div>
			</div>
		</div> <!-- / .container -->
	</div>
	
	
<!-- scripts -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://appfog.com/js/libs/jquery-1.7.1.min.js"><\/script>')</script>
<script src="http://appfog.com/js/plugins.js"></script>
<script src="http://appfog.com/js/script.js"></script>
<script type="text/javascript" src="/js/docs.js"></script>

</body>
</html>
